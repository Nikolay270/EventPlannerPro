@model EventPlannerPro.ViewModels.OrganizerIndexViewModel
@using System.Security.Claims
@{
    ViewData["Title"] = "Моят профил";
    var ratings = ViewBag.Ratings as IDictionary<string, double>
                  ?? new Dictionary<string, double>();
    var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
}

<main class="container-fixed">
    <h2 class="mb-4">Моят профил</h2>

    <h3 class="mb-3">Моите събития</h3>
    @if (!Model.MyActivities.Any())
    {
        <p>Все още не сте създали никакви събития.</p>
    }
    else
    {
        <div class="activity-grid mb-5">
            @foreach (var a in Model.MyActivities)
            {
                <div class="activity-card">
                    @if (!string.IsNullOrEmpty(a.PhotoUrl))
                    {
                        <img src="@a.PhotoUrl" alt="@a.Title" />
                    }
                    <div class="activity-card-body">
                        <h5>@a.Title</h5>
                        <p>@a.Description</p>
                        <small>
                            <strong>Град:</strong> @a.City?.Name<br />
                            <strong>Дата:</strong> @a.StartTime.ToString("dd MMM yyyy HH:mm")
                        </small>
                    </div>
                    <div class="activity-card-footer">
                        <a asp-controller="Activities"
                           asp-action="Details"
                           asp-route-id="@a.Id"
                           class="btn-custom btn-sm">
                            Подробности
                        </a>
                        <a asp-controller="Activities"
                           asp-action="Edit"
                           asp-route-id="@a.Id"
                           class="btn-custom btn-sm">
                            Редактирай
                        </a>
                        <form asp-controller="Activities"
                              asp-action="Delete"
                              asp-route-id="@a.Id"
                              method="post"
                              class="d-inline">
                            <button type="submit"
                                    class="btn-custom btn-sm"
                                    onclick="return confirm('Наистина ли желаете да изтриете това събитие?');">
                                Изтрий
                            </button>
                        </form>
                    </div>
                </div>
            }
        </div>
    }

    <hr class="my-4" />

    <h2 class="mb-3">Всички организатори</h2>
    <div class="activity-grid">
        @foreach (var u in Model.Organizers)
        {
            var avg = ratings.TryGetValue(u.Id, out var s) ? s : 0.0;
            var stars = new string('★', (int)Math.Round(avg)).PadRight(5, '☆');

            <div class="activity-card text-center">
                <div class="activity-card-body">
                    <h5>@u.UserName</h5>
                    <small class="text-muted">@u.Email</small>
                    <p class="mt-2 mb-0">
                        <strong>Рейтинг:</strong> @avg.ToString("0.0")
                        <span style="color:#ffc107">@stars</span>
                    </p>
                </div>
                <div class="activity-card-footer">
                    <a asp-action="Profile"
                       asp-route-id="@u.Id"
                       class="btn-custom btn-sm w-100">
                        Виж профила
                    </a>
                </div>
            </div>
        }
    </div>
</main>
